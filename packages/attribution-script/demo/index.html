<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RefRef Attribution Script Demo</title>
    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
          Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        line-height: 1.6;
      }
      .form-container {
        border: 1px solid #ddd;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
      }
      form {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }
      label {
        font-weight: 500;
      }
      input,
      button {
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      button {
        background: #0066cc;
        color: white;
        border: none;
        cursor: pointer;
        padding: 10px;
      }
      button:hover {
        background: #0052a3;
      }
      #attribution-data {
        background: #f5f5f5;
        padding: 15px;
        border-radius: 4px;
        margin-top: 20px;
      }
      .hidden-fields {
        margin-top: 15px;
        font-size: 0.9em;
        color: #666;
      }
    </style>
  </head>
  <body>
    <h1>RefRef Attribution Script Demo</h1>
    <p>
      This page demonstrates the RefRef attribution script functionality. Try
      accessing with different URL parameters:
    </p>
    <ul>
      <li><code>?rfc=TEST123</code> - Sets referral code</li>
    </ul>

    <div class="form-container">
      <h2>Simple Sign Up Form</h2>
      <form data-refref id="signup-form">
        <div>
          <label for="name">Name:</label>
          <input type="text" id="name" name="name" required />
        </div>
        <div>
          <label for="email">Email:</label>
          <input type="email" id="email" name="email" required />
        </div>
        <button type="submit">Sign Up</button>
        <div class="hidden-fields">
          <strong>Hidden Fields:</strong>
          <pre id="signup-hidden-fields"></pre>
        </div>
      </form>
    </div>

    <div class="form-container">
      <h2>Contact Form</h2>
      <form data-refref id="contact-form">
        <div>
          <label for="contact-name">Name:</label>
          <input type="text" id="contact-name" name="contact-name" required />
        </div>
        <div>
          <label for="contact-email">Email:</label>
          <input
            type="email"
            id="contact-email"
            name="contact-email"
            required
          />
        </div>
        <div>
          <label for="message">Message:</label>
          <input type="text" id="message" name="message" required />
        </div>
        <button type="submit">Send Message</button>
        <div class="hidden-fields">
          <strong>Hidden Fields:</strong>
          <pre id="contact-hidden-fields"></pre>
        </div>
      </form>
    </div>

    <div id="attribution-data">
      <h3>Current Attribution Data</h3>
      <pre id="current-data"></pre>
    </div>

    <script src="../dist/index.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Initialize RefRef
        const attribution = window.RefRef.init({
          cookieOptions: {
            domain: window.location.hostname,
            maxAge: 30 * 24 * 60 * 60, // 30 days
          },
        });

        // Attach to all forms
        attribution.attachToAll();

        // Function to display hidden fields
        function displayHiddenFields(formId, displayId) {
          const form = document.getElementById(formId);
          const hiddenFields = Array.from(
            form.querySelectorAll('input[type="hidden"]')
          )
            .map((field) => `${field.name}: ${field.value}`)
            .join("\n");
          document.getElementById(displayId).textContent = hiddenFields;
        }

        // Display current attribution data
        function updateAttributionDisplay() {
          const data = attribution.getAttributionData();
          document.getElementById("current-data").textContent = JSON.stringify(
            data,
            null,
            2
          );
        }

        // Update displays initially
        displayHiddenFields("signup-form", "signup-hidden-fields");
        displayHiddenFields("contact-form", "contact-hidden-fields");
        updateAttributionDisplay();

        // Handle form submissions
        ["signup-form", "contact-form"].forEach((formId) => {
          document.getElementById(formId).addEventListener("submit", (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = {};
            for (let [key, value] of formData.entries()) {
              data[key] = value;
            }
            console.log(`${formId} submission:`, data);
            alert("Form submitted! Check console for data");
          });
        });

        // Update displays when attribution data changes
        setInterval(() => {
          displayHiddenFields("signup-form", "signup-hidden-fields");
          displayHiddenFields("contact-form", "contact-hidden-fields");
          updateAttributionDisplay();
        }, 1000);
      });
    </script>
  </body>
</html>
